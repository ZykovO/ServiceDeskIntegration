@if (!this.isLoading && formFields) {
  <p-card class="mb-3 shadow-2">
    <ng-template pTemplate="header">
      <div class="flex align-items-center gap-2 p-2 bg-black-alpha-40 text-white border-round-top">
        <i class="pi pi-lock text-primary text-sm"></i>
        <span class="text-lg font-bold">Закрытие заявки</span>
      </div>
    </ng-template>

    @if (formFields.header && formFields.header.dpl && formFields.header.tc && formFields.header.problemsubcategory_id && formFields.header.performer_name && formFields.header.performer_ids && formFields.header.respondent_name) {
      <div class="grid gap-2 p-2">

        <!-- Первый ряд: Дата и время в одной строке -->
        <div class="col-12">
          <div class="flex gap-2">
            <div class="flex-1">
              <label class="text-xs text-300 font-semibold block mb-1">{{ formFields.header.dpl.placeholder }}</label>
              <p-datePicker
                [id]="formFields.header.dpl.id"
                dateFormat="dd.mm.yy"
                styleClass="w-full"
                [style]="{'width': '100%', 'font-size': '0.875rem'}">
              </p-datePicker>
            </div>
            <div class="flex-1">
              <label class="text-xs text-300 font-semibold block mb-1">{{ formFields.header.tc.placeholder }}</label>
              <p-datePicker
                [id]="formFields.header.tc.id"
                [timeOnly]="true"
                styleClass="w-full"
                [style]="{'width': '100%', 'font-size': '0.875rem'}">
              </p-datePicker>
            </div>
          </div>
        </div>

        <!-- Второй ряд: Подкатегория (полная ширина) -->
        <div class="col-12">
          <label
            class="text-xs text-300 font-semibold block mb-1">{{ formFields.header.problemsubcategory_id.placeholder }}</label>
          <p-select
            [options]="formFields.header.problemsubcategory_id.options"
            optionLabel="text"
            optionValue="value"
            class="w-full"
            [panelStyle]="{'max-width': '150px'}"
            [style]="{'font-size': '0.875rem'}">
          </p-select>
        </div>

        <!-- Третий ряд: Исполнители -->
        <div class="col-12">
          <div class="flex gap-2">
            <div class="flex-1">
              <label
                class="text-xs text-300 font-semibold block mb-1">{{ formFields.header.performer_name.placeholder }}</label>
              <input pInputText
                     [type]="formFields.header.performer_name.type || 'text'"
                     [readonly]="formFields.header.performer_name.readonly"
                     [value]="formFields.header.performer_name.value"
                     class="w-full text-sm"
                     style="width: 100%"/>
            </div>
            <div class="flex-1">
              <label
                class="text-xs text-300 font-semibold block mb-1">{{ formFields.header.performer_ids.placeholder }}</label>
              <div class="relative">
                <p-multiSelect
                  [options]="formFields.header.performer_ids.options"
                  optionLabel="text"
                  optionValue="value"
                  styleClass="w-full">
                </p-multiSelect>
              </div>
            </div>
          </div>
        </div>

        <!-- Четвертый ряд: Данные клиента -->
        <div class="col-12">
          <div class="flex gap-2">
            <div class="flex-auto" style="flex: 0 0 60%">
              <label
                class="text-xs text-300 font-semibold block mb-1">{{ formFields.header.respondent_name.placeholder }}</label>
              <span class="text-100 text-xs opacity-70 block mb-1">* ФИО клиента</span>
              <input pInputText
                     [type]="formFields.header.respondent_name.type || 'text'"
                     [readonly]="formFields.header.respondent_name.readonly"
                     [defaultValue]="'---'"
                     class="w-full text-sm"
                     style="width: 100%"/>
            </div>
            <div class="flex-auto" style="flex: 0 0 40%">
              <label class="text-xs text-300 font-semibold block mb-1">Должность</label>
              <input pInputText
                     id="respondent_post"
                     type="text"
                     [readonly]="false"
                     [defaultValue]="'управ.'"
                     class="w-full text-sm"
                     style="width: 100%"/>
            </div>
          </div>
        </div>

        <!-- Пятый ряд: Текстовые области (стекируются вертикально на мобильных) -->
        <div class="col-12">
          <label class="text-xs text-300 font-semibold block mb-1">{{ formFields.header.reason?.placeholder }}</label>
          <textarea pTextarea
                    rows="3"
                    [id]="formFields.header.reason?.id"
                    [readonly]="formFields.header.reason?.readonly"
                    [value]="formFields.header.reason?.value"
                    class="w-full text-sm">
          </textarea>
        </div>

        <div class="col-12">
          <label class="text-xs text-300 font-semibold block mb-1">{{ formFields.header.worked?.placeholder }}</label>
          <textarea pTextarea
                    rows="3"
                    [id]="formFields.header.worked?.id"
                    [readonly]="formFields.header.worked?.readonly"
                    [value]="formFields.header.worked?.value"
                    class="w-full text-sm">
          </textarea>
        </div>
      </div>
    }

    <!-- Компонент загрузки файлов -->
    <app-upload-file-component [ticketId]="ticket!.InternalId">

    </app-upload-file-component>

  </p-card>
} @else {
  <p-skeleton class="w-full h-full"/>
}
