@if (!this.isLoading && ticket) {

  <div class="flex flex-column h-full w-full p-2">
    <!-- Основная информация -->
    <p-card class="mb-3 shadow-2 text-white">
      <ng-template pTemplate="header">
        <div class="flex align-items-center justify-content-between p-3 bg-black-alpha-40 text-white border-round-top">
          <div class="flex flex-column">
            <span class="text-xl font-bold">№{{ ticket?.InternalId }}</span>
            <span class="text-sm opacity-80" *ngIf="ticket?.ExternalId">Внешний: {{ ticket?.ExternalId }}</span>
          </div>
<!--          <p-chip-->
<!--            [label]="ticket?.Status ? 'Активная' : 'Закрытая'"-->
<!--            [styleClass]="ticket?.Status ? 'bg-green-500' : 'bg-orange-500'"-->
<!--            class="text-white">-->
<!--          </p-chip>-->
        </div>
      </ng-template>

      <!-- Компактная информация в две колонки -->
      <div class="grid">
        <div class="col-12 md:col-6">
          <div class="field mb-2" *ngIf="ticket?.Customer">
            <label class="text-sm text-300 font-semibold block mb-1">Заказчик</label>
            <span class="text-100">{{ ticket?.Customer }}</span>
          </div>

          <div class="field mb-2" *ngIf="ticket?.Shop">
            <label class="text-sm text-300 font-semibold block mb-1">Магазин</label>
            <span class="text-100">{{ ticket?.Shop }}</span>
          </div>

          <div class="field mb-2" *ngIf="ticket?.Type">
            <label class="text-sm text-300 font-semibold block mb-1">Тип</label>
            <span class="text-100">{{ ticket?.Type }}</span>
          </div>
        </div>

        <div class="col-12 md:col-6">
          <div class="field mb-2" *ngIf="ticket?.PerformerName">
            <label class="text-sm text-300 font-semibold block mb-1">Исполнитель</label>
            <span class="text-100">{{ ticket?.PerformerName }}</span>
          </div>

          <div class="field mb-2" *ngIf="ticket?.Contractor">
            <label class="text-sm text-300 font-semibold block mb-1">Подрядчик</label>
            <span class="text-100">{{ ticket?.Contractor }}</span>
          </div>

          <div class="field mb-2" *ngIf="ticket?.ACtStatus">
            <label class="text-sm text-300 font-semibold block mb-1">Статус АЦТ</label>
            <span class="text-100">{{ ticket?.ACtStatus }}</span>
          </div>
        </div>
      </div>
    </p-card>

    <!-- Адрес и локация -->
    <p-card class="mb-3 shadow-1" *ngIf="ticket?.Address || ticket?.ShopCity || ticket?.Region">
      <ng-template pTemplate="header">
        <div class="flex align-items-center gap-2 p-3 border-bottom-1 surface-border">
          <i class="pi pi-map-marker text-primary"></i>
          <span class="font-semibold">Местоположение</span>
        </div>
      </ng-template>

      <div class="field mb-2" *ngIf="ticket?.Address">
        <span class="text-100">{{ ticket?.Address }}</span>
      </div>

      <div class="flex gap-2 flex-wrap">
        <p-chip *ngIf="ticket?.ShopCity" [label]="ticket?.ShopCity ?? ''" class="bg-blue-100 text-blue-800"></p-chip>
        <p-chip *ngIf="ticket?.Region" [label]="ticket?.Region ?? ''" class="bg-purple-100 text-purple-800"></p-chip>
      </div>
    </p-card>

    <!-- Временная информация -->
    <p-card class="mb-3 shadow-1">
      <ng-template pTemplate="header">
        <div class="flex align-items-center gap-2 p-3 border-bottom-1 surface-border">
          <i class="pi pi-calendar text-primary"></i>
          <span class="font-semibold">Временная информация</span>
        </div>
      </ng-template>

      <div class="grid">
        <div class="col-6" *ngIf="ticket?.DateCreate">
          <label class="text-sm text-300 font-semibold block mb-1">Создана</label>
          <span class="text-100 text-sm">{{ ticket?.DateCreate | date:'dd.MM.yyyy HH:mm' }}</span>
        </div>

        <div class="col-6" *ngIf="ticket?.Deadline">
          <label class="text-sm text-300 font-semibold block mb-1">Срок</label>
          <span class="text-100 text-sm"
                [class]="isDeadlineExpired(ticket?.Deadline ?? null) ? 'text-red-500' : 'text-green-500'">
          {{ ticket?.Deadline | date:'dd.MM.yyyy HH:mm' }}
        </span>
        </div>

        <div class="col-6" *ngIf="ticket?.DateApprove">
          <label class="text-sm text-300 font-semibold block mb-1">Утверждена</label>
          <span class="text-100 text-sm">{{ ticket?.DateApprove | date:'dd.MM.yyyy HH:mm' }}</span>
        </div>

        <div class="col-6" *ngIf="ticket?.DateClose">
          <label class="text-sm text-300 font-semibold block mb-1">Закрыта</label>
          <span class="text-100 text-sm">{{ ticket?.DateClose | date:'dd.MM.yyyy HH:mm' }}</span>
        </div>
      </div>
    </p-card>

    <!-- Описание работ -->
    <p-card class="mb-3 shadow-1" *ngIf="ticket?.Text || ticket?.CompletedWork">
      <ng-template pTemplate="header">
        <div class="flex align-items-center gap-2 p-3 border-bottom-1 surface-border">
          <i class="pi pi-file-edit text-primary"></i>
          <span class="font-semibold">Описание работ</span>

        </div>
          <div class="grid col-12 m-1">
            <span class="text-100 text-sm">{{ ticket?.Text}}</span>
          </div>
      </ng-template>

    </p-card>



    <!-- Комментарии -->
    <p-card class="mb-3 shadow-1" *ngIf="ticket?.Comentaries?.length">
      <ng-template pTemplate="header">
        <div class="flex align-items-center justify-content-between p-3 border-bottom-1 surface-border">
          <div class="flex align-items-center gap-2">
            <i class="pi pi-comments text-primary"></i>
            <span class="font-semibold">Комментарии</span>
          </div>
          <p-chip [label]="ticket?.Comentaries?.length?.toString() || '0'" class="bg-blue-500 text-white"></p-chip>
        </div>
      </ng-template>

      <div class="flex flex-column gap-2">
        @for (comment of ticket.Comentaries; track comment.LocalId; let i = $index) {
          <p-fieldset
            legend="{{comment.Author}}"
            [toggleable]="true"
            [collapsed]="i < ticket.Comentaries.length - 2">

            <p class="m-0">
              {{ comment.Text }}
            </p>
            <p class="m-0">{{ comment.DatetimeAdd }}</p>
          </p-fieldset>
        }
      </div>
    </p-card>


    <!-- Кнопки действий -->
    <p-card class="mt-auto shadow-2" *ngIf="ticket?.ActionsButtons">
      <ng-template pTemplate="header">
        <div class="flex align-items-center justify-content-between p-3 border-bottom-1 surface-border">
          <div class="flex align-items-center gap-2">
            <i class="pi pi-check-circle text-primary"></i>
            <span class="font-semibold">Закрыть заявку:</span>
          </div>
        </div>
      </ng-template>
      <div class="flex align-items-stretch flex-wrap w-full">
        <p-button
          *ngFor="let button of ticket.ActionsButtons.CloseButtons"
          [label]="button.ActName"
          class="flex-1 align-self-auto border-round m-1 col-6"
          (onClick)="executeAction(button.ActType)">
        </p-button>
      </div>
    </p-card>

  </div>


} @else {
  <p-skeleton class="w-full h-full"/>
}

