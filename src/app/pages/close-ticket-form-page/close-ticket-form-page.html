<p-progressSpinner *ngIf="loading" [style]="{ width: '50px', height: '50px' }"
                   styleClass="telegram-loading-spinner">
</p-progressSpinner>

<p-card *ngIf="error" styleClass="telegram-error-card">
  <ng-template pTemplate="content">
    <p-message severity="error" [text]="error"></p-message>
    <p-button label="Повернутись"
              severity="secondary"
              (onClick)="goBack()"
              styleClass="telegram-secondary-button mt-3">
    </p-button>
  </ng-template>
</p-card>

<p-card *ngIf="requestData && preparenewForm && !loading"
        styleClass="telegram-form-card">

  <ng-template pTemplate="header">
    <div class="flex justify-content-between align-items-center">
      <h2 class="m-0 text-xl font-semibold">Закриття заявки</h2>
      <p-button label="Назад"
                severity="secondary"
                size="small"
                (onClick)="goBack()"
                styleClass="telegram-secondary-button">
      </p-button>
    </div>
  </ng-template>

  <ng-template pTemplate="content">
    <div class="grid">
      <div class="col-12">
        <h3 class="text-base font-medium mb-3 text-color-secondary">
          Інформація про запит
        </h3>

        <div class="form-fields">
          @for (formField of preparenewForm.header; track formField.id) {
            <div class="field"
                 [ngClass]="{'field-block': formField.field_type === 'textarea'}">

              <label [for]="formField.id"
                     class="field-label"
                     [ngClass]="{'block-label': formField.field_type === 'textarea'}">
                {{ formField.placeholder }}
              </label>

              @switch (formField.field_type) {

                @case ('input') {
                  <input [id]="formField.id"
                         pInputText
                         [type]="formField.type"
                         [readonly]="formField.readonly"
                         [(ngModel)]="formField.value"
                         styleClass="telegram-input w-full" />
                }

                @case ('textarea') {
                  <textarea [id]="formField.id"
                            pInputTextarea
                            [readonly]="formField.readonly"
                            [(ngModel)]="formField.value"
                            [autoResize]="true"
                            rows="3"
                            styleClass="telegram-textarea w-full">
                  </textarea>
                }

                @case ('select') {
                  <!-- [multiple]="formField.multiple" -->
                  <p-select [inputId]="formField.id"
                            [options]="getSelectOptions(formField)"
                            optionLabel="text"
                            optionValue="value"

                            [disabled]="formField.disabled"
                            [required]="formField.required"
                            placeholder="Оберіть опцію"
                            styleClass="telegram-select w-full">
                  </p-select>
                }

                @case ('file') {
                  <!-- [accept]="formField.accept" -->
                  <p-fileUpload [id]="formField.id"
                                mode="basic"

                                [multiple]="formField.multiple"
                                [disabled]="formField.disabled"
                                [auto]="false"
                                chooseLabel="Обрати файл"
                                styleClass="telegram-file-upload w-full">
                  </p-fileUpload>
                }
              }
            </div>
          }
        </div>
      </div>
    </div>
  </ng-template>

  <ng-template pTemplate="footer">
    <div class="flex gap-2 flex-wrap">
      <p-button [label]="loading ? 'Відправка...' : 'Закрити заявку'"
                (onClick)="submitForm()"
                [disabled]="loading"
                [loading]="loading"
                styleClass="telegram-primary-button flex-1">
      </p-button>

      <p-button label="Скасувати"
                severity="secondary"
                (onClick)="goBack()"
                styleClass="telegram-secondary-button flex-1">
      </p-button>
    </div>
  </ng-template>
</p-card>

<!-- Debug информация -->
<p-accordion *ngIf="requestData && !loading && preparenewForm"
             styleClass="telegram-debug-accordion mt-4">
    <pre class="debug-pre">{{ requestData | json }}</pre>
    <p-divider></p-divider>
    <pre class="debug-pre">{{ preparenewForm | json }}</pre>
</p-accordion>
