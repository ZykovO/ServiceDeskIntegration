<div *ngIf="loading" class="telegram-loading">Завантаження...</div>
<div *ngIf="error" class="telegram-error">
  {{ error }}
  <button class="telegram-button secondary" (click)="goBack()" style="margin-top: 12px;">
    Повернутись
  </button>
</div>

<div *ngIf="requestData && preparenewForm && !loading" class="telegram-card">
  <div class="card-header">
    <h2 class="card-title">Закриття заявки</h2>
    <button class="telegram-button secondary small" (click)="goBack()">
      Назад
    </button>
  </div>

  <div class="card-section">
    <h3 class="section-title">Інформація про запит</h3>

    @for (formField of preparenewForm.header; track formField.id) {
      <div class="info-item">
        <div class="info-item" [ngClass]="{'block': formField.field_type === 'textarea'}">
          <label [for]="formField.id" class="info-label">
            {{ formField.placeholder }}
          </label>

          @switch (formField.field_type) {

            @case ('input') {
              <input [id]="formField.id"
                     class="form-input"
                     [type]="formField.type"
                     [readonly]="formField.readonly"
                     [(ngModel)]="formField.value" />
            }

            @case ('textarea') {
              <textarea [id]="formField.id"
                        class="form-textarea"
                        [readonly]="formField.readonly"
                        [(ngModel)]="formField.value"></textarea>
            }

            @case ('select') {
              <select [id]="formField.id"
                      class="form-select"
                      [multiple]="formField.multiple"
                      [disabled]="formField.disabled"
                      [required]="formField.required">
                @for (option of formField.options; track option.value) {
                  <option [value]="option.value" [selected]="option.selected">
                    {{ option.text }}
                  </option>
                }
              </select>
            }

            @case ('file') {
              <input [id]="formField.id"
                     type="file"
                     class="form-file"
                     [accept]="formField.accept"
                     [multiple]="formField.multiple"
                     [disabled]="formField.disabled"
                     [required]="formField.required" />
            }

          }
        </div>


      </div>
    }
  </div>


  <div class="card-actions">
    <button
      class="telegram-button primary"
      (click)="submitForm()"
      [disabled]="loading">
      {{ loading ? 'Відправка...' : 'Закрити заявку' }}
    </button>

    <button
      class="telegram-button secondary"
      (click)="goBack()">
      Скасувати
    </button>
  </div>
</div>

<!-- Debug information (remove in production) -->
<div *ngIf="requestData && !loading && preparenewForm" class="debug-section">
  <details>
    <summary>Debug Info (JSON)</summary>
    <pre>{{ requestData | json }}</pre>
    <pre>{{ preparenewForm | json }}</pre>

  </details>
</div>
