<p-progressSpinner *ngIf="isLoading" [style]="{ width: '50px', height: '50px' }"
                   styleClass="telegram-loading-spinner">
</p-progressSpinner>

<p-message *ngIf="error" severity="error" [text]="error"
           styleClass="telegram-error-message">
</p-message>

<p-card *ngIf="ticket" styleClass="telegram-ticket-card">
  <ng-template pTemplate="header">
    <div class="flex justify-content-between align-items-center">
      <h2 class="m-0 text-xl font-semibold">
        Заявка №{{ ticket.InternalId }} ({{ ticket.ExternalId }})
      </h2>
      <p-tag [value]="ticket.Status ? 'Виконано' : 'В роботі'"
             [severity]="ticket.Status ? 'success' : 'warning'"
             styleClass="telegram-status-tag">
      </p-tag>
    </div>
  </ng-template>

  <ng-template pTemplate="content">
    <div class="grid">
      <div class="col-12">
        <h3 class="text-base font-medium mb-3 text-color-secondary">Основна інформація</h3>

        <div class="field-group">
          <div class="field">
            <label class="field-label">Тип:</label>
            <span class="field-value">{{ ticket.Type }}</span>
          </div>

          <div class="field">
            <label class="field-label">Магазин:</label>
            <span class="field-value">{{ ticket.Shop }}</span>
          </div>

          <div class="field">
            <label class="field-label">Місто:</label>
            <span class="field-value">{{ ticket.ShopCity }}</span>
          </div>

          <div class="field">
            <label class="field-label">Дата створення:</label>
            <span class="field-value">{{ ticket.DateCreate }}</span>
          </div>

          <div class="field">
            <label class="field-label">Срок заявки:</label>
            <span class="field-value">{{ ticket.Deadline }}</span>
          </div>
        </div>
      </div>

      <div class="col-12" *ngIf="ticket.Comentaries?.length">
        <p-divider></p-divider>
        <h3 class="text-base font-medium mb-3 text-color-secondary">Коментарі</h3>

        <div class="comments-list">
          <div *ngFor="let comment of ticket.Comentaries" class="comment-item">
            <p-card styleClass="telegram-comment-card">
              <ng-template pTemplate="header">
                <div class="flex justify-content-between align-items-center px-3 py-2">
                  <span class="font-medium text-sm">{{ comment.Author }}</span>
                  <span class="text-xs text-color-secondary">{{ comment.DatetimeAdd }}</span>
                </div>
              </ng-template>
              <ng-template pTemplate="content">
                <p class="m-0 text-sm line-height-3">{{ comment.Text }}</p>
              </ng-template>
            </p-card>
          </div>
        </div>
      </div>
    </div>
  </ng-template>

  <ng-template pTemplate="footer">
    <div class="flex gap-2 flex-wrap">
      <p-button
        *ngFor="let ActionsButton of ticket?.ActionsButtons?.CloseButtons"
        [label]="ActionsButton.ActName"
        (onClick)="goToDetailsPage(ticket, ActionsButton.ActType)"
        styleClass="telegram-primary-button flex-1">
      </p-button>
    </div>
  </ng-template>
</p-card>
